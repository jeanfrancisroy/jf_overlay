diff --git a/libudev/libudev-ctrl.c b/libudev/libudev-ctrl.c
index e0ec2fa..6702033 100644
--- a/udev-171.orig/libudev/libudev-ctrl.c
+++ b/udev-171/libudev/libudev-ctrl.c
@@ -15,6 +15,7 @@
 #include <stddef.h>
 #include <string.h>
 #include <unistd.h>
+#include <fcntl.h>
 #include <sys/types.h>
 #include <sys/poll.h>
 #include <sys/socket.h>
@@ -179,6 +180,7 @@ struct udev_ctrl_connection *udev_ctrl_get_connection(struct udev_ctrl *uctrl)
 	struct ucred ucred;
 	socklen_t slen;
 	const int on = 1;
+	int flgs;
 
 	conn = calloc(1, sizeof(struct udev_ctrl_connection));
 	if (conn == NULL)
@@ -186,13 +188,19 @@ struct udev_ctrl_connection *udev_ctrl_get_connection(struct udev_ctrl *uctrl)
 	conn->refcount = 1;
 	conn->uctrl = uctrl;
 
-	conn->sock = accept4(uctrl->sock, NULL, NULL, SOCK_CLOEXEC|SOCK_NONBLOCK);
+//	conn->sock = accept4(uctrl->sock, NULL, NULL, SOCK_CLOEXEC|SOCK_NONBLOCK);
+	conn->sock = accept(uctrl->sock, NULL, NULL);
 	if (conn->sock < 0) {
 		if (errno != EINTR)
 			err(uctrl->udev, "unable to receive ctrl connection: %m\n");
 		goto err;
 	}
 
+// Since we don't have accept4
+	flgs = fcntl(conn->sock, F_GETFL, NULL);
+	if(flgs >= 0) fcntl(conn->sock, F_SETFL, flgs | O_NONBLOCK);
+	fcntl(conn->sock, F_SETFD, FD_CLOEXEC);
+
 	/* check peer credential of connection */
 	slen = sizeof(ucred);
 	if (getsockopt(conn->sock, SOL_SOCKET, SO_PEERCRED, &ucred, &slen) < 0) {
